{"file":"/sarabc/maze","data":"[width, height] = [9,9]\ngrid = table(width, height).home()\n\nsides = [\n  {dx: 0, dy: -1, ob: 'borderTop', ib: 'borderBottom'}\n  {dx: 1, dy: 0, ob: 'borderRight', ib: 'borderLeft'}\n  {dx: 0, dy: 1, ob: 'borderBottom', ib: 'borderTop'}\n  {dx: -1, dy: 0, ob: 'borderLeft', ib: 'borderRight'}\n]\n\nisopen = (x, y, side) ->\n  return /none/.test(\n    grid.cell(y,x).css side.ob)\n    \nisbox = (x, y) ->\n  return false unless (\n    0 <= x < width and\n    0 <= y < height)\n  for s in sides\n    if isopen x, y, s\n      return false\n  return true\n  \nmakemaze = (x, y) ->\n  loop\n    adj = (s for s in sides when isbox x + s.dx, y + s.dy)\n    if adj.length is 0 then return\n    choice = random adj\n    [nx, ny] = [x + choice.dx, y + choice.dy]\n    grid.cell(x, y).css choice.ob, 'none'\n    grid.cell(ny, nx).css choice.ib, 'none'\n    makemaze nx, ny\n\nwander = (x, y, lastdir) ->\n  moveto grid.cell y, x\n  for d in [lastdir + 3 .. lastdir + 7]\n    dir = d % 4\n    s = sides[dir]\n    if isopen x, y, s then break\n  turnto grid.cell y + s.dy, x + s.dx unless dir is lastdir\n  plan -> wander x + s.dx, y + s.dy, dir\n  \nmakemaze 0, 0, 0\nspeed 5\nwander 4, 4, 0\n","auth":true,"mtime":1445958086000,"mime":"text/x-pencilcode;charset=utf-8"}